{"version":3,"file":"release.js","sourceRoot":"","sources":["../../../src/js/integrations/release.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,uBAAuB,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAEtE,OAAO,EAAE,aAAa,EAAE,MAAM,cAAc,CAAC;AAE7C,MAAM,EAAE,QAAQ,EAAE,GAAG,aAAa,CAAC;AAEnC,iEAAiE;AACjE,MAAM,OAAO,OAAO;IAApB;QACE;;WAEG;QACI,SAAI,GAAW,OAAO,CAAC,EAAE,CAAC;IA0CnC,CAAC;IApCC;;OAEG;IACI,SAAS;QACd,uBAAuB,CAAC,CAAO,KAAY,EAAE,EAAE;YAC7C,MAAM,IAAI,GAAG,aAAa,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;YACrD,IAAI,CAAC,IAAI,EAAE;gBACT,OAAO,KAAK,CAAC;aACd;YAED,IAAI;gBACF,0CAA0C;gBAC1C,MAAM,OAAO,GAAG,CAAC,MAAM,QAAQ,CAAC,YAAY,EAAE,CAI7C,CAAC;gBACF,IAAI,OAAO,EAAE;oBACX,KAAK,CAAC,OAAO,GAAG,GAAG,OAAO,CAAC,EAAE,IAAI,OAAO,CAAC,OAAO,EAAE,CAAC;oBACnD,KAAK,CAAC,IAAI,GAAG,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;iBACjC;aACF;YAAC,OAAO,GAAG,EAAE;gBACZ,yCAAyC;aAC1C;YAED,qFAAqF;YACrF,IAAI,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC,gBAAgB,EAAE;gBAC/C,KAAK,CAAC,OAAO,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,gBAAgB,EAAE,CAAC;aACnD;YACD,IAAI,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC,aAAa,EAAE;gBAC5C,KAAK,CAAC,IAAI,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC;aAC7C;YAED,OAAO,KAAK,CAAC;QACf,CAAC,CAAA,CAAC,CAAC;IACL,CAAC;;AAxCD;;GAEG;AACW,UAAE,GAAW,SAAS,CAAC","sourcesContent":["import { addGlobalEventProcessor, getCurrentHub } from \"@sentry/core\";\nimport { Event, Integration } from \"@sentry/types\";\nimport { NativeModules } from \"react-native\";\n\nconst { RNSentry } = NativeModules;\n\n/** Release integration responsible to load release from file. */\nexport class Release implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public name: string = Release.id;\n  /**\n   * @inheritDoc\n   */\n  public static id: string = \"Release\";\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(): void {\n    addGlobalEventProcessor(async (event: Event) => {\n      const self = getCurrentHub().getIntegration(Release);\n      if (!self) {\n        return event;\n      }\n\n      try {\n        // tslint:disable-next-line: no-unsafe-any\n        const release = (await RNSentry.fetchRelease()) as {\n          build: string;\n          id: string;\n          version: string;\n        };\n        if (release) {\n          event.release = `${release.id}-${release.version}`;\n          event.dist = `${release.build}`;\n        }\n      } catch (_Oo) {\n        // Something went wrong, we just continue\n      }\n\n      // If __sentry_release or __sentry_dist it should be stronger because the user set it\n      if (event.extra && event.extra.__sentry_release) {\n        event.release = `${event.extra.__sentry_release}`;\n      }\n      if (event.extra && event.extra.__sentry_dist) {\n        event.dist = `${event.extra.__sentry_dist}`;\n      }\n\n      return event;\n    });\n  }\n}\n"]}